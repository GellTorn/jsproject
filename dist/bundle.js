(()=>{"use strict";const t=function(){function t(t){void 0===t&&(t={}),this.game=t.game||null,this.cameras=t.cameras||[];for(var e=0,i=this.cameras;e<i.length;e++)i[e].scene=this;this.objects=t.objects||[];for(var s=0,n=this.objects;s<n.length;s++)n[s].scene=this;this.updateList=[],this.createTime=Date.now(),this.lastTimePaused=this.createTime,this.time=0,this.timeTick=0,this._paused=t.paused||!1,this.update=t.update||function(){}}return t.prototype.createCamera=function(t){return t.scene=this,this.cameras.push(t),t},t.prototype.createEntity=function(t){return t.scene=this,this.objects.push(t),t},t.prototype.createUpdateList=function(){this.updateList=[];for(var t=0,e=this.objects;t<e.length;t++){var i=e[t];i.active&&this.updateList.push(i)}for(var s=0,n=this.cameras;s<n.length;s++){var o=n[s];o.active&&this.updateList.push(o)}return this},Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(t){t&&(this.lastTimePaused=Date.now()),this._paused=t},enumerable:!1,configurable:!0}),t}(),e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.fromVector=function(e){return new t(e.x,e.y)},t.fromArray=function(e){return new t(e[0],e[1])},t.prototype.set=function(t,e){return void 0===e&&(e=t),this.x=t,this.y=e,this},t.prototype.setToPolar=function(t,e){return void 0===e&&(e=1),this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.angle=function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},t.prototype.setAngle=function(t){return this.setToPolar(t,this.length())},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},t.prototype.scale=function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.distance=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},t.prototype.distanceSq=function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.setLength=function(t){return this.normalize().scale(t)},t.prototype.lengthSq=function(){var t=this.x,e=this.y;return t*t+e*e},t.prototype.normalize=function(){var t=this.x,e=this.y,i=t*t+e*e;return i>0&&(i=1/Math.sqrt(i),this.x=t*i,this.y=e*i),this},t.prototype.normalizeRightHand=function(){var t=this.x;return this.x=-1*this.y,this.y=t,this},t.prototype.normalizeLeftHand=function(){var t=this.x;return this.x=this.y,this.y=-1*t,this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.lerp=function(t,e){void 0===e&&(e=0);var i=this.x,s=this.y;return this.x=i+e*(t.x-i),this.y=s+e*(t.y-s),this},t.prototype.reset=function(){return this.x=0,this.y=0,this},t.prototype.limit=function(t){var e=this.length();return e&&e>t&&this.scale(t/e),this},t.prototype.reflect=function(e){return e=t.fromVector(e).normalize(),this.subtract(e.scale(2*this.dot(e)))},t.prototype.mirror=function(t){return this.reflect(t).negate()},t.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e*this.x-i*this.y,i*this.x+e*this.y)},t.prototype.toPolar=function(){return{p:Math.sqrt(this.x*this.x+this.y*this.y),q:Math.atan2(this.y,this.x)}},t}(),i=function(){function t(t){void 0===t&&(t={}),this.scene=t.scene||null,this.position=t.position||new e,this.velocity=t.velocity||new e,this.acceleration=t.acceleration||new e,this.mass=t.mass||1,this.active=t.active||!1,this.physics=t.physics||!1,this.isDraw=t.isDraw||!0,this._angle=t.angle||0,this._body=t.body||null,this.delete=!1,this.name=t.name||null,this.data=t.data||{},this.update=t.update||function(){},this.parent=t.parent||null}return Object.defineProperty(t.prototype,"body",{get:function(){return this._body},set:function(t){t.parent=this,this._body=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"calculatedPosition",{get:function(){return new e(this.position.x+this.parent.position.x,this.position.y+this.parent.position.y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"calculatedAngle",{get:function(){return this.angle+this.parent.angle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(t){var e=2*Math.PI;t>e?t-=e:t<-e&&(t+=e),this._angle=Math.round(1e3*t)/1e3},enumerable:!1,configurable:!0}),t.prototype.draw=function(t){},t.prototype.offscreen=function(t){return!(this.position.distance(t.position)>2e3)},t.prototype.applyForce=function(t,e){return this.acceleration.x+=t/this.mass,this.acceleration.y+=e/this.mass,this},t}();var s,n=(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});const o=function(t){function e(e){void 0===e&&(e={});var i=t.call(this,e)||this;return i.radius=e.radius||0,i.drawingType=e.drawingType||"stroke",i.name=i.name||"Circle",i.color=e.color||"#000",i}return n(e,t),e.prototype.draw=function(t){t.save(),t.strokeStyle=this.color,t.fillStyle=this.color,t.lineWidth=1,t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),"fill"===this.drawingType?t.fill():t.stroke(),t.restore()},e.prototype.area=function(){return this.radius>0?Math.PI*this.radius*this.radius:0},e.prototype.intersectCircle=function(t){return this.position.distance(t.position)<this.radius+t.radius},e.prototype.intersectPoint=function(t){return this.position.distance(t)<this.radius},e}(i);var r=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();const h=function(t){function i(i){void 0===i&&(i={});var s=t.call(this,i)||this;return s.size=i.size||new e(0,0),s.drawingType=i.drawingType||"fill",s.name=s.name||"Rectangle",s.color=i.color||"#000",s}return r(i,t),i.prototype.draw=function(t){t.save(),t.strokeStyle=this.color,t.fillStyle=this.color,t.beginPath(),t.rect(-this.size.x/2,-this.size.y/2,this.size.x,this.size.y),"fill"===this.drawingType?t.fill():t.stroke(),t.restore()},i.prototype.area=function(t){return t.size.x*t.size.y},i.intersectPointWithAngle=function(t,e){var i=t.size.x/2,s=t.size.y/2,n=t.position.distance(e.position),o=Math.cos(t.angle)*n,r=Math.sin(t.angle)*n;return!(o>i||o<-i||r>s||r<-s)},i.intersectPointWithoutAngle=function(t,e){return!(Math.abs(t.position.x-e.x)>t.size.x/2||Math.abs(t.position.y-e.y)>t.size.y/2)},i.intersectAABB=function(t,e){return!(Math.abs(t.position.x-e.position.x)>t.size.x/2+e.size.x/2||Math.abs(t.position.y-e.position.y)>t.size.y/2+e.size.y/2)},i}(i),c=function(){function t(t){void 0===t&&(t={}),this.gravity=new e(0,0),this.game=t.game||null,this.collisions=[]}return t.prototype.setCollision=function(t,e,i){var s={bodyA:t,bodyB:e,callback:i};return this.collisions.push(s),s},t.prototype.checkCollision=function(t){(t.bodyA instanceof o&&t.bodyB instanceof o&&t.bodyA.intersectCircle(t.bodyB)||t.bodyA instanceof h&&t.bodyB instanceof h&&h.intersectAABB(t.bodyB,t.bodyB)||t.bodyA instanceof h&&t.bodyB&&h.intersectPointWithoutAngle(t.bodyA,t.bodyB.position)||t.bodyA&&t.bodyB instanceof h&&h.intersectPointWithoutAngle(t.bodyB,t.bodyA.position))&&t.callback()},t.prototype.update=function(t,e){for(var i=0,s=this.game.scene.objects;i<s.length;i++){var n=s[i];n.physics&&(n.velocity.x*=.95,n.velocity.y*=.95,n.velocity.x+=n.acceleration.x,n.velocity.y+=n.acceleration.y,n.position.x+=n.velocity.x,n.position.y+=n.velocity.y,n.acceleration.x=0,n.acceleration.y=0)}this.collisions=this.collisions.filter((function(t){return!t.bodyA.delete&&!t.bodyB.delete}));for(var o=0,r=this.collisions;o<r.length;o++){var h=r[o];this.checkCollision(h)}},t}();!function(){function i(t){void 0===t&&(t={}),this.canvas=t.canvas||null,this.version="0.0.1",this.width=t.width||600,this.height=t.height||400,this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d",{alpha:t.alpha}),this.ctx.imageSmoothingEnabled=t.imageSmoothingEnabled||!1,this.backgroudColor=t.backgroudColor||null,this.scenes=t.scenes||{},this.resources={},this.preload=t.preload||function(){},this.create=t.create||function(){},this.scene=null,this.physics=t.physics||new c({game:this}),this.debug=t.debug||!1,this.frameAmount=0,this.fps=0,this.mouse=new e,this.events=[],this.mouseObjects=[],window.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("click",this.onMouseClick.bind(this)),window.addEventListener("mousedown",this.onMouseDown.bind(this)),window.addEventListener("mouseup",this.onMouseUp.bind(this)),window.addEventListener("contextmenu",this.onContextMenu.bind(this)),window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this)),window.addEventListener("wheel",this.onWheel.bind(this)),this.preload(),this._preloadDoneInterval=setInterval(this._preloadDone.bind(this),100)}i.prototype.onMouseMove=function(t){this.mouse.set(t.offsetX,t.offsetY)},i.prototype.onMouseClick=function(t){t.preventDefault()},i.prototype.onContextMenu=function(t){t.preventDefault()},i.prototype.onMouseDown=function(t){this.events.push("mouse"+t.button),this.mouse.set(t.offsetX,t.offsetY),t.preventDefault()},i.prototype.onMouseUp=function(t){var e=this.events.indexOf("mouse"+t.button);-1!=e&&(this.events.splice(e,1),this.mouse.set(t.offsetX,t.offsetY),t.preventDefault())},i.prototype.onKeyDown=function(t){t.repeat||this.events.push(t.code)},i.prototype.onKeyUp=function(t){for(;-1!=this.events.indexOf(t.code);){var e=this.events.indexOf(t.code);this.events.splice(e,1)}t.preventDefault()},i.prototype.onWheel=function(t){t.deltaY<0?this.events.push("up"):t.deltaY>0&&this.events.push("down")},i.prototype.onFocus=function(t){this.scene.paused=!1},i.prototype.onBlur=function(t){this.scene.paused=!0},i.prototype.checkEventCode=function(t,e){},i.prototype.setScene=function(t){return this.scene=this.scenes[t],this},i.prototype.createScene=function(e,i){void 0===i&&(i={});var s=new t(i);return s.game=this,this.scenes[e]=s,s},i.prototype.check=function(){this.fps=this.frameAmount,this.frameAmount=0},i.prototype.loadImage=function(t,e){var i=this,s=new Image;return this.resources[t]={resource:s,loaded:!1},s.src=e,s.onload=function(){i.resources[t].loaded=!0},s.onload.bind(this),this},i.prototype.loadVideo=function(t,e){var i=this,s=document.createElement("video");return s.muted=!0,s.loop=!0,this.resources[t]={resource:s,loaded:!1},s.src=e,s.onload=function(){i.resources[t].loaded=!0,s.play()},s.onload.bind(this),this},i.prototype.getResource=function(t){return this.resources[t].resource},i.prototype._preloadDone=function(){for(var t in this.resources)if(!this.resources[t].loaded)return console.log("not ready"),!1;clearInterval(this._preloadDoneInterval),this.create(),console.info("Game engine v"+this.version),window.requestAnimationFrame(this.update.bind(this)),this._setFps=setInterval(this.check.bind(this),1e3)},i.prototype.update=function(){if(null!=this.scene){if(!this.scene.paused){this.scene.time=Date.now()-this.scene.lastTimePaused,this.scene.timeTick++,this.scene.objects=this.scene.objects.filter((function(t){return!t.delete})),this.scene.createUpdateList(),this.physics.update(this.scene.time,this.scene.timeTick);for(var t=0,e=this.scene.updateList;t<e.length;t++)(c=e[t]).update(this.scene.time,this.scene.timeTick);this.scene.update(this.scene.time,this.scene.timeTick)}this.backgroudColor?(this.ctx.fillStyle=this.backgroudColor,this.ctx.fillRect(0,0,this.width,this.height)):this.ctx.clearRect(0,0,this.width,this.height);for(var i=0,s=this.scene.cameras;i<s.length;i++)s[i].render();if(this.debug){this.ctx.textAlign="left",this.ctx.font="8px",this.ctx.fillStyle="#000",this.ctx.fillText(this.fps+" fps",2,10),this.ctx.fillText("camera("+this.scene.cameras[0].position.x+", "+this.scene.cameras[0].position.y+", "+this.scene.cameras[0].zoom+")",2,30);var n=this.scene.cameras[0].getMouseCoordinates();this.ctx.fillText("mouse("+this.mouse.x+", "+this.mouse.y+") ("+n.x+", "+n.y+") Mouse events: "+this.events,2,40),this.ctx.fillText("mouseObjects: "+this.mouseObjects.map((function(t){return t.name})),2,50),this.ctx.fillText("time: "+(this.scene.time/1e3).toFixed(1)+" s",2,20);for(var o=60,r=0,h=this.scene.objects;r<h.length;r++){var c;(c=h[r]).position&&(this.ctx.fillText(c.name+"("+c.position.x+", "+c.position.y+", "+c.angle+")",2,o),o+=10)}}this.frameAmount++;for(var a=0,u=["up","down"];a<u.length;a++)for(var p=u[a];-1!=this.events.indexOf(p);){var l=this.events.indexOf(p);this.events.splice(l,1)}window.requestAnimationFrame(this.update.bind(this))}}}()})();